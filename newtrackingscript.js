(function(){'use strict';var i={'pvEndpoint':'https://productview.optymyze.io/pv/public/storepagevisit','trackingEndpoint':'https://storeview.optymyze.io/tracking/public/storeactivities','customerEndpoint':'https://storeview.optymyze.io/tracking/public/storecustomeractivity','checkoutEndpoint':'https://storeview.optymyze.io/tracking/public/storecheckout','storageKeys':{'uniqueId':'sv_app_unique_id','cartData':'cart_raw_data','customerId':'sv_stored_customer_id','customerTimestamp':'sv_customer_timestamp'}},K={'get':function(p){try{return localStorage['getItem'](p);}catch(H){return null;}},'set':function(p,H){try{localStorage['setItem'](p,H);}catch(n){}},'remove':function(p){try{localStorage['removeItem'](p);}catch(H){}}};function u(){var p='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',H='';for(var n=0x0;n<0x20;n++){H+=p['charAt'](Math['floor'](Math['random']()*p['length']));}return H;}function j(){var p=K['get'](i['storageKeys']['uniqueId']);return!p&&(p=u(),K['set'](i['storageKeys']['uniqueId'],p)),p;}function c(p,H){var n=new XMLHttpRequest();n['open']('POST',p,!![]),n['setRequestHeader']('Content-type','application/x-www-form-urlencoded'),n['send'](H);}function W(p,H){var n=H['split']('.'),U=p;for(var A=0x0;A<n['length'];A++){if(U==null||typeof U[n[A]]==='undefined')return![];U=U[n[A]];}return!![];}function R(p,H,n){var U=H['split']('.'),A=p;for(var m=0x0;m<U['length'];m++){if(A==null||typeof A[U[m]]==='undefined')return n;A=A[U[m]];}return A;}function t(p){var H={};for(var n=0x0;n<p['length'];n++){H[p[n]['product_id']]=p[n]['quantity'];}return H;}function d(p){return p?p['split']('?')[0x0]:p;}function y(){var p='/'+document['location']['href']['split']('/')['slice'](0x3)['join']('/'),H='',n=!K['get'](i['storageKeys']['uniqueId']);n&&document['referrer']&&document['referrer']['indexOf'](window['location']['hostname'])===-0x1&&(H=document['referrer']);var U=j(),A=null,m=null;if(W(ShopifyAnalytics,'meta.product')){A=ShopifyAnalytics['meta']['product']['id'];var V=R(ShopifyAnalytics,'meta.product.variants',[]);if(V['length']>0x0&&V[0x0]['name']){m=V[0x0]['name'];if(V['length']>0x1){var b=m['lastIndexOf']('-');b!==-0x1&&(m=m['substring'](0x0,b)['trim']());}}}var q='shop_name='+Shopify['shop']+'&unique_id='+U+'&page_url='+encodeURIComponent(p)+'&timestamp='+Date['now']()+'&product_id='+encodeURIComponent(A)+'&product_name='+encodeURIComponent(m)+'&referrer='+encodeURIComponent(H);c(i['pvEndpoint'],q),e();}function e(){var p=R(ShopifyAnalytics,'meta.page.customerId',null),H=K['get'](i['storageKeys']['customerId']);if(p){var n=p['toString']();if(!H||H!==n){K['set'](i['storageKeys']['customerId'],n),K['set'](i['storageKeys']['customerTimestamp'],Date['now']()['toString']());var U='shop_name='+Shopify['shop']+'&customer_id='+p+'&timestamp='+Date['now']()+'&unique_id='+j();c(i['customerEndpoint'],U);}}else K['remove'](i['storageKeys']['customerId']),K['remove'](i['storageKeys']['customerTimestamp']);}function G(){var p=new XMLHttpRequest();p['open']('GET','https://'+window['location']['hostname']+'/cart.json',!![]),p['onreadystatechange']=function(){p['readyState']===0x4&&p['status']===0xc8&&X(p['responseText']);},p['send']();}function X(p){var H=JSON['parse'](p);H['token']&&(H['token']=d(H['token']));var n=K['get'](i['storageKeys']['cartData']),U=n?JSON['parse'](n):null,A=JSON['stringify'](H);if(A===n)return;if(H['item_count']===0x0&&U){H['token']===U['token']&&U['items']&&U['items']['length']>0x0&&(K['set'](i['storageKeys']['cartData'],A),L(H,U));return;}H['item_count']>0x0&&(K['set'](i['storageKeys']['cartData'],A),L(H,U));}function L(p,H){var n=[],U=!H||p['token']!==H['token'];if(U)for(var A=0x0;A<p['items']['length'];A++){var m=p['items'][A];n['push']({'cart_id':p['token'],'type':'added','product_id':m['product_id'],'product_name':m['title'],'quantity':m['quantity'],'amount':m['discounted_price'],'timestamp':Date['now']()});}else{var V=t(H['items']),b=t(p['items']);for(var A=0x0;A<p['items']['length'];A++){var m=p['items'][A],q=m['product_id'],k=V[q];if(typeof k==='undefined')n['push']({'cart_id':p['token'],'type':'added','product_id':q,'product_name':m['title'],'quantity':m['quantity'],'amount':m['discounted_price']});else{var C=m['quantity']-k;if(C>0x0)n['push']({'cart_id':p['token'],'type':'increased','product_id':q,'product_name':m['title'],'quantity':m['quantity'],'amount':m['discounted_price'],'difference':C});else C<0x0&&n['push']({'cart_id':p['token'],'type':'decreased','product_id':q,'product_name':m['title'],'quantity':m['quantity'],'amount':m['discounted_price'],'difference':-C});}}for(var A=0x0;A<H['items']['length'];A++){var m=H['items'][A];typeof b[m['product_id']]==='undefined'&&n['push']({'cart_id':H['token'],'type':'removed','product_id':m['product_id'],'product_name':m['title'],'quantity':m['quantity'],'amount':m['discounted_price']});}}n['length']>0x0&&Q(n,p);}function Q(p,H){var n=R(ShopifyAnalytics,'meta.page.customerId',''),U=H['items']['length']>0x0?JSON['stringify'](H['items']):'',A='shop_name='+Shopify['shop']+'&data='+encodeURIComponent(JSON['stringify'](p))+'&timestamp='+Date['now']()+'&cart_items='+encodeURIComponent(U)+'&customer_id='+n+'&unique_id='+j()+'&currency='+H['currency'];c(i['trackingEndpoint'],A);}function h(p){var H=JSON['stringify']({'checkout_token':p,'unique_id':j()});navigator['sendBeacon'](i['checkoutEndpoint'],H);}function S(p){return p['indexOf']('/cart/add')!==-0x1||p['indexOf']('/cart/update')!==-0x1||p['indexOf']('/cart/change')!==-0x1||p['indexOf']('/cart/clear')!==-0x1;}typeof $!=='undefined'&&$['ajaxComplete']&&$(document)['ajaxComplete'](function(p,H,n){S(n['url'])&&G();}),function(p){if(typeof p!=='function')return;window['fetch']=function(){var H=arguments,n=p['apply'](this,H);return n['then'](function(U){S(U['url'])&&G();if(U['url']==='https://monorail-edge.shopifysvc.com/v1/produce')try{var A=JSON['parse'](H[0x1]['body']);A['payload']&&A['payload']['event']==='spb_checkout_created'&&h(A['payload']['checkout_token']);}catch(m){}}),n;};}(window['fetch']),y(),G();}());