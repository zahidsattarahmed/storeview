(function(){'use strict';var O={'pvEndpoint':'https://productview.optymyze.io/pv/public/storepagevisit','trackingEndpoint':'https://storeview.optymyze.io/tracking/public/storeactivities','customerEndpoint':'https://storeview.optymyze.io/tracking/public/storecustomeractivity','checkoutEndpoint':'https://storeview.optymyze.io/tracking/public/storecheckout','storageKeys':{'uniqueId':'sv_app_unique_id','cartData':'cart_raw_data','customerId':'sv_stored_customer_id','customerTimestamp':'sv_customer_timestamp'}},M={'get':function(V){try{return localStorage['getItem'](V);}catch(C){return null;}},'set':function(V,C){try{localStorage['setItem'](V,C);}catch(w){}},'remove':function(V){try{localStorage['removeItem'](V);}catch(C){}}};function s(){var V='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',C='';for(var e=0x0;e<0x20;e++){C+=V['charAt'](Math['floor'](Math['random']()*V['length']));}return C;}function W(){var V=M['get'](O['storageKeys']['uniqueId']);return!V&&(V=s(),M['set'](O['storageKeys']['uniqueId'],V)),V;}function u(V,C){var e=new XMLHttpRequest();e['open']('POST',V,!![]),e['setRequestHeader']('Content-type','application/x-www-form-urlencoded'),e['send'](C);}function B(V,C){var e=C['split']('.'),w=V;for(var Z=0x0;Z<e['length'];Z++){if(w==null||typeof w[e[Z]]==='undefined')return![];w=w[e[Z]];}return!![];}function D(V,C,e){var w=C['split']('.'),Z=V;for(var x=0x0;x<w['length'];x++){if(Z==null||typeof Z[w[x]]==='undefined')return e;Z=Z[w[x]];}return Z;}function K(V){var C={};for(var e=0x0;e<V['length'];e++){C[V[e]['product_id']]=V[e]['quantity'];}return C;}function G(V){return V?V['split']('?')[0x0]:V;}function P(){var V='/'+document['location']['href']['split']('/')['slice'](0x3)['join']('/'),C='',e=!M['get'](O['storageKeys']['uniqueId']);e&&document['referrer']&&document['referrer']['indexOf'](window['location']['hostname'])===-0x1&&(C=document['referrer']);var w=W(),Z=null,x=null;if(B(ShopifyAnalytics,'meta.product')){Z=ShopifyAnalytics['meta']['product']['id'];var l=D(ShopifyAnalytics,'meta.product.variants',[]);if(l['length']>0x0&&l[0x0]['name']){x=l[0x0]['name'];if(l['length']>0x1){var T=x['lastIndexOf']('-');T!==-0x1&&(x=x['substring'](0x0,T)['trim']());}}}var N='shop_name='+Shopify['shop']+'&unique_id='+w+'&page_url='+V+'&timestamp='+Date['now']()+'&product_id='+encodeURIComponent(Z)+'&product_name='+encodeURIComponent(x)+'&referrer='+encodeURIComponent(C);u(O['pvEndpoint'],N),H();}function H(){var V=D(ShopifyAnalytics,'meta.page.customerId',null),C=M['get'](O['storageKeys']['customerId']);if(V){var e=V['toString']();if(!C||C!==e){M['set'](O['storageKeys']['customerId'],e),M['set'](O['storageKeys']['customerTimestamp'],Date['now']()['toString']());var w='shop_name='+Shopify['shop']+'&customer_id='+V+'&timestamp='+Date['now']()+'&unique_id='+W();u(O['customerEndpoint'],w);}}else M['remove'](O['storageKeys']['customerId']),M['remove'](O['storageKeys']['customerTimestamp']);}function J(){var V=new XMLHttpRequest();V['open']('GET','https://'+window['location']['hostname']+'/cart.json',!![]),V['onreadystatechange']=function(){V['readyState']===0x4&&V['status']===0xc8&&v(V['responseText']);},V['send']();}function v(V){var C=JSON['parse'](V);C['token']&&(C['token']=G(C['token']));var e=M['get'](O['storageKeys']['cartData']),w=e?JSON['parse'](e):null,Z=JSON['stringify'](C);if(Z===e)return;if(C['item_count']===0x0&&w){C['token']===w['token']&&w['items']&&w['items']['length']>0x0&&(M['set'](O['storageKeys']['cartData'],Z),I(C,w));return;}C['item_count']>0x0&&(M['set'](O['storageKeys']['cartData'],Z),I(C,w));}function I(V,C){var e=[],w=!C||V['token']!==C['token'];if(w)for(var Z=0x0;Z<V['items']['length'];Z++){var x=V['items'][Z];e['push']({'cart_id':V['token'],'type':'added','product_id':x['product_id'],'product_name':x['title'],'quantity':x['quantity'],'amount':x['discounted_price'],'timestamp':Date['now']()});}else{var l=K(C['items']),T=K(V['items']);for(var Z=0x0;Z<V['items']['length'];Z++){var x=V['items'][Z],N=x['product_id'],n=l[N];if(typeof n==='undefined')e['push']({'cart_id':V['token'],'type':'added','product_id':N,'product_name':x['title'],'quantity':x['quantity'],'amount':x['discounted_price']});else{var y=x['quantity']-n;if(y>0x0)e['push']({'cart_id':V['token'],'type':'increased','product_id':N,'product_name':x['title'],'quantity':x['quantity'],'amount':x['discounted_price'],'difference':y});else y<0x0&&e['push']({'cart_id':V['token'],'type':'decreased','product_id':N,'product_name':x['title'],'quantity':x['quantity'],'amount':x['discounted_price'],'difference':-y});}}for(var Z=0x0;Z<C['items']['length'];Z++){var x=C['items'][Z];typeof T[x['product_id']]==='undefined'&&e['push']({'cart_id':C['token'],'type':'removed','product_id':x['product_id'],'product_name':x['title'],'quantity':x['quantity'],'amount':x['discounted_price']});}}e['length']>0x0&&E(e,V);}function E(V,C){var e=D(ShopifyAnalytics,'meta.page.customerId',''),w=C['items']['length']>0x0?JSON['stringify'](C['items']):'',Z='shop_name='+Shopify['shop']+'&data='+encodeURIComponent(JSON['stringify'](V))+'&timestamp='+Date['now']()+'&cart_items='+encodeURIComponent(w)+'&customer_id='+e+'&unique_id='+W()+'&currency='+C['currency'];u(O['trackingEndpoint'],Z);}function q(V){var C=JSON['stringify']({'checkout_token':V,'unique_id':W()});navigator['sendBeacon'](O['checkoutEndpoint'],C);}function X(V){return V['indexOf']('/cart/add')!==-0x1||V['indexOf']('/cart/update')!==-0x1||V['indexOf']('/cart/change')!==-0x1||V['indexOf']('/cart/clear')!==-0x1;}typeof $!=='undefined'&&$['ajaxComplete']&&$(document)['ajaxComplete'](function(V,C,e){X(e['url'])&&J();}),function(V){if(typeof V!=='function')return;window['fetch']=function(){var C=arguments,e=V['apply'](this,C);return e['then'](function(w){X(w['url'])&&J();if(w['url']==='https://monorail-edge.shopifysvc.com/v1/produce')try{var Z=JSON['parse'](C[0x1]['body']);Z['payload']&&Z['payload']['event']==='spb_checkout_created'&&q(Z['payload']['checkout_token']);}catch(x){}}),e;};}(window['fetch']),P(),J();}());