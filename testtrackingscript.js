(function(){'use strict';var m={'pvEndpoint':'https://productview.optymyze.io/pv/public/storepagevisit','trackingEndpoint':'https://storeview.optymyze.io/tracking/public/storeactivities','customerEndpoint':'https://storeview.optymyze.io/tracking/public/storecustomeractivity','checkoutEndpoint':'https://storeview.optymyze.io/tracking/public/storecheckout','storageKeys':{'uniqueId':'sv_app_unique_id','cartData':'cart_raw_data','customerId':'sv_stored_customer_id','customerTimestamp':'sv_customer_timestamp'}},a={'get':function(t){try{return localStorage['getItem'](t);}catch(k){return null;}},'set':function(t,k){try{localStorage['setItem'](t,k);}catch(c){}},'remove':function(t){try{localStorage['removeItem'](t);}catch(k){}}};function i(){var t='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',k='';for(var c=0x0;c<0x20;c++){k+=t['charAt'](Math['floor'](Math['random']()*t['length']));}return k;}function C(){var t=a['get'](m['storageKeys']['uniqueId']);return!t&&(t=i(),a['set'](m['storageKeys']['uniqueId'],t)),t;}function S(t,k){var c=new XMLHttpRequest();c['open']('POST',t,!![]),c['setRequestHeader']('Content-type','application/x-www-form-urlencoded'),c['send'](k);}function z(t,k){var c=k['split']('.'),O=t;for(var D=0x0;D<c['length'];D++){if(O==null||typeof O[c[D]]==='undefined')return![];O=O[c[D]];}return!![];}function s(t,k,c){var O=k['split']('.'),D=t;for(var p=0x0;p<O['length'];p++){if(D==null||typeof D[O[p]]==='undefined')return c;D=D[O[p]];}return D;}function V(t){var k={};for(var c=0x0;c<t['length'];c++){k[t[c]['product_id']]=t[c]['quantity'];}return k;}function A(t){return t?t['split']('?')[0x0]:t;}function Q(){var t='/'+document['location']['href']['split']('/')['slice'](0x3)['join']('/'),k='',c=!a['get'](m['storageKeys']['uniqueId']);c&&document['referrer']&&document['referrer']['indexOf'](window['location']['hostname'])===-0x1&&(k=document['referrer']);var O=C(),D=null,p=null;if(z(ShopifyAnalytics,'meta.product')){D=ShopifyAnalytics['meta']['product']['id'];var M=s(ShopifyAnalytics,'meta.product.variants',[]);if(M['length']>0x0&&M[0x0]['name']){p=M[0x0]['name'];if(M['length']>0x1){var q=p['lastIndexOf']('-');q!==-0x1&&(p=p['substring'](0x0,q)['trim']());}}}var f='shop_name='+Shopify['shop']+'&unique_id='+O+'&page_url='+t+'&timestamp='+Date['now']()+'&product_id='+encodeURIComponent(D)+'&product_name='+encodeURIComponent(p)+'&referrer='+encodeURIComponent(k);S(m['pvEndpoint'],f),I();}function I(){var t=s(ShopifyAnalytics,'meta.page.customerId',null),k=a['get'](m['storageKeys']['customerId']);if(t){var c=t['toString']();if(!k||k!==c){a['set'](m['storageKeys']['customerId'],c),a['set'](m['storageKeys']['customerTimestamp'],Date['now']()['toString']());var O='shop_name='+Shopify['shop']+'&customer_id='+t+'&timestamp='+Date['now']()+'&unique_id='+C();S(m['customerEndpoint'],O);}}else a['remove'](m['storageKeys']['customerId']),a['remove'](m['storageKeys']['customerTimestamp']);}function n(){var t=new XMLHttpRequest();t['open']('GET','https://'+window['location']['hostname']+'/cart.json',!![]),t['onreadystatechange']=function(){t['readyState']===0x4&&t['status']===0xc8&&X(t['responseText']);},t['send']();}function X(t){var k=JSON['parse'](t);k['token']&&(k['token']=A(k['token']));var c=a['get'](m['storageKeys']['cartData']),O=c?JSON['parse'](c):null,D=JSON['stringify'](k);if(D===c)return;if(k['item_count']===0x0&&O){k['token']===O['token']&&O['items']&&O['items']['length']>0x0&&(a['set'](m['storageKeys']['cartData'],D),R(k,O));return;}k['item_count']>0x0&&(a['set'](m['storageKeys']['cartData'],D),R(k,O));}function R(t,k){var c=[],O=!k||t['token']!==k['token'];if(O)for(var D=0x0;D<t['items']['length'];D++){var p=t['items'][D];c['push']({'cart_id':t['token'],'type':'added','product_id':p['product_id'],'product_name':p['title'],'quantity':p['quantity'],'amount':p['discounted_price'],'timestamp':Date['now']()});}else{var M=V(k['items']),q=V(t['items']);for(var D=0x0;D<t['items']['length'];D++){var p=t['items'][D],f=p['product_id'],U=M[f];if(typeof U==='undefined')c['push']({'cart_id':t['token'],'type':'added','product_id':f,'product_name':p['title'],'quantity':p['quantity'],'amount':p['discounted_price']});else{var y=p['quantity']-U;if(y>0x0)c['push']({'cart_id':t['token'],'type':'increased','product_id':f,'product_name':p['title'],'quantity':p['quantity'],'amount':p['discounted_price'],'difference':y});else y<0x0&&c['push']({'cart_id':t['token'],'type':'decreased','product_id':f,'product_name':p['title'],'quantity':p['quantity'],'amount':p['discounted_price'],'difference':-y});}}for(var D=0x0;D<k['items']['length'];D++){var p=k['items'][D];typeof q[p['product_id']]==='undefined'&&c['push']({'cart_id':k['token'],'type':'removed','product_id':p['product_id'],'product_name':p['title'],'quantity':p['quantity'],'amount':p['discounted_price']});}}c['length']>0x0&&d(c,t);}function d(t,k){var c=s(ShopifyAnalytics,'meta.page.customerId',''),O=k['items']['length']>0x0?JSON['stringify'](k['items']):'',D='shop_name='+Shopify['shop']+'&data='+encodeURIComponent(JSON['stringify'](t))+'&timestamp='+Date['now']()+'&cart_items='+encodeURIComponent(O)+'&customer_id='+c+'&unique_id='+C()+'&currency='+k['currency'];S(m['trackingEndpoint'],D);}function B(t){var k=JSON['stringify']({'checkout_token':t,'unique_id':C()});navigator['sendBeacon'](m['checkoutEndpoint'],k);}function v(t){return t['indexOf']('/cart/add')!==-0x1||t['indexOf']('/cart/update')!==-0x1||t['indexOf']('/cart/change')!==-0x1||t['indexOf']('/cart/clear')!==-0x1;}typeof $!=='undefined'&&$['ajaxComplete']&&$(document)['ajaxComplete'](function(t,k,c){v(c['url'])&&n();}),function(t){if(typeof t!=='function')return;window['fetch']=function(){var k=arguments,c=t['apply'](this,k);return c['then'](function(O){v(O['url'])&&n();if(O['url']==='https://monorail-edge.shopifysvc.com/v1/produce')try{var D=JSON['parse'](k[0x1]['body']);D['payload']&&D['payload']['event']==='spb_checkout_created'&&B(D['payload']['checkout_token']);}catch(p){}}),c;};}(window['fetch']),Q(),n();}());